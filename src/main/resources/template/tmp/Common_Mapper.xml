<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="common">
    <sql id="If_Example_Conditon_Valid">
        <trim prefix="(" suffix=")" prefixOverrides="and">
            <foreach collection="criterionEntries" item="criterionEntry">
                <if test="criterionEntry.criterion">
                    <choose>
                        <when test="criterionEntry.criterion.noValue">
                            and ${criterionEntry.criterion.condition}
                        </when>
                        <when test="criterionEntry.criterion.singleValue">
                            and ${criterionEntry.criterion.condition} #{criterionEntry.criterion.value}
                        </when>
                        <when test="criterionEntry.criterion.betweenValue">
                            and ${criterionEntry.criterion.condition} #{criterionEntry.criterion.value} and
                            #{criterionEntry.criterion.secondValue}
                        </when>
                        <when test="criterionEntry.criterion.listValue">
                            and ${criterionEntry.criterion.condition}
                            <foreach collection="criterionEntry.criterion.value" item="listItem" open="(" close=")" separator=",">
                                #{listItem}
                            </foreach>
                        </when>
                        <when test="criterionEntry.criterion.dateValue">
                            and ${criterionEntry.criterion.condition #{criterionEntry.criterion.value,jdbcType=TIMESTAMP}
                        </when>
                    </choose>
                </if>
            </foreach>
        </trim>
    </sql>

    <sql id="If_Example_Conditon_Order">
        <trim prefix="order by " suffix="" suffixOverrides=",">
            <foreach collection="orderEntries" item="orderEntry">
                <if test="orderEntry.order">
                    ${orderEntry.order} ,
                </if>
            </foreach>
        </trim>
    </sql>

    <!--
   1）参数为map，包含example
   2）参数为example
   -->
    <sql id="Example_Where_Clause">
        <where>
            <if test="example != null and example.valid">
                <bind name="criterionEntries" value="example.criterionEntries"/>
                <include refid="common.If_Example_Conditon_Valid"/>
            </if>

            <if test="example == null and valid">
                <include refid="common.If_Example_Conditon_Valid"/>
            </if>
        </where>

        <if test="example != null and example.order">
            <bind name="orderEntries" value="example.orderEntries"/>
            <include refid="common.If_Example_Conditon_Order"/>
        </if>

        <if test="example == null and order">
            <include refid="common.If_Example_Conditon_Order"/>
        </if>
    </sql>

    <sql id="Update_By_Example_Where_Clause">
        <where>
            <if test="example != null and example.valid">
                <bind name="criterionEntries" value="example.criterionEntries"/>
                <include refid="common.If_Example_Conditon_Valid"/>
            </if>
            <if test="example == null and valid">
                <include refid="common.If_Example_Conditon_Valid"/>
            </if>
        </where>
    </sql>
</mapper>